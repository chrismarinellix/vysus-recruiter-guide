<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recruiter Pre-Screening Guide | Vysus Group</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            /* Primary */
            --vysus-stockholm-neon: #00E3A9;
            --vysus-malmo-green: #005454;

            /* Neutrals */
            --vysus-white: #FFFFFF;
            --vysus-oslo-snow: #F8F8F8;
            --vysus-stavanger-ice: #EDEDED;
            --vysus-bergen-rain: #DADADA;
            --vysus-scandinavia-rock: #485559;
            --vysus-trondheim-night: #1D1D1B;

            /* Typography */
            --vysus-font-primary: 'Suisse International', Arial, sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--vysus-font-primary);
            font-weight: 300;
            color: var(--vysus-trondheim-night);
            line-height: 1.2;
            background: var(--vysus-white);
        }

        /* Header with Chevron Background */
        .header {
            background: var(--vysus-malmo-green);
            padding: 60px 40px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 60%;
            height: 200%;
            background: var(--vysus-stockholm-neon);
            transform: skewX(-15deg);
            opacity: 0.15;
        }

        .header::after {
            content: '';
            position: absolute;
            top: -30%;
            right: 5%;
            width: 40%;
            height: 160%;
            background: var(--vysus-stockholm-neon);
            transform: skewX(-15deg);
            opacity: 0.1;
        }

        .header-content {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 40px;
        }

        .vysus-marque {
            width: 50px;
            height: auto;
        }

        .logo-text {
            color: var(--vysus-white);
            font-size: 24px;
            font-weight: 300;
            letter-spacing: 2px;
        }

        .header h1 {
            color: var(--vysus-white);
            font-size: 48px;
            font-weight: 300;
            margin-bottom: 16px;
            line-height: 1.1;
        }

        .header .subtitle {
            color: var(--vysus-stockholm-neon);
            font-size: 20px;
            font-weight: 400;
        }

        /* Main Content */
        .main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 60px 40px 120px;
        }

        /* Introduction */
        .intro {
            background: var(--vysus-oslo-snow);
            padding: 40px;
            margin-bottom: 60px;
            border-left: 4px solid var(--vysus-stockholm-neon);
        }

        .intro h2 {
            color: var(--vysus-malmo-green);
            font-size: 24px;
            font-weight: 400;
            margin-bottom: 16px;
        }

        .intro p {
            color: var(--vysus-scandinavia-rock);
            font-size: 16px;
            line-height: 1.5;
        }

        /* Role Progression - Clean 3-column design */
        .role-progression {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            margin-bottom: 60px;
        }

        .role-card {
            background: var(--vysus-white);
            border: 2px solid var(--vysus-bergen-rain);
            position: relative;
        }

        .role-card.lead {
            border-color: rgba(0, 227, 169, 0.4);
        }

        .role-card.principal {
            border-color: var(--vysus-stockholm-neon);
        }

        .role-card-header {
            padding: 20px 24px;
            background: var(--vysus-stavanger-ice);
            border-bottom: 2px solid var(--vysus-bergen-rain);
        }

        .role-card.lead .role-card-header {
            background: rgba(0, 227, 169, 0.15);
            border-bottom-color: rgba(0, 227, 169, 0.4);
        }

        .role-card.principal .role-card-header {
            background: var(--vysus-stockholm-neon);
            border-bottom-color: var(--vysus-stockholm-neon);
        }

        .role-card-header h3 {
            font-size: 18px;
            font-weight: 400;
            color: var(--vysus-malmo-green);
            margin: 0;
        }

        .role-card-header .focus {
            font-size: 12px;
            color: var(--vysus-scandinavia-rock);
            margin-top: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .role-card.principal .role-card-header .focus {
            color: var(--vysus-malmo-green);
        }

        .role-card-body {
            padding: 20px 24px;
        }

        .role-card-body ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .role-card-body li {
            padding: 8px 0;
            font-size: 14px;
            color: var(--vysus-scandinavia-rock);
            border-bottom: 1px solid var(--vysus-stavanger-ice);
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .role-card-body li:last-child {
            border-bottom: none;
        }

        .role-card-body li::before {
            content: '';
            width: 6px;
            height: 6px;
            background: var(--vysus-bergen-rain);
            margin-top: 6px;
            flex-shrink: 0;
        }

        /* NEW items get emphasis */
        .role-card-body li.new-skill {
            color: var(--vysus-malmo-green);
            font-weight: 400;
        }

        .role-card-body li.new-skill::before {
            background: var(--vysus-stockholm-neon);
            width: 8px;
            height: 8px;
            margin-top: 5px;
        }

        .new-badge {
            font-size: 10px;
            padding: 2px 6px;
            background: var(--vysus-stockholm-neon);
            color: var(--vysus-malmo-green);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-left: auto;
            flex-shrink: 0;
        }

        .role-card.lead .new-badge {
            background: rgba(0, 227, 169, 0.3);
        }

        @media (max-width: 900px) {
            .role-progression {
                grid-template-columns: 1fr;
            }

            .leadership-bracket {
                display: none;
            }
        }

        /* Leadership bracket */
        .leadership-bracket {
            margin-top: -20px;
            margin-bottom: 60px;
            padding-left: calc(33.33% + 12px);
        }

        .bracket-visual {
            display: flex;
            align-items: flex-start;
            height: 30px;
            position: relative;
        }

        .bracket-arm {
            flex: 1;
            height: 16px;
            border-bottom: 3px solid var(--vysus-stockholm-neon);
        }

        .bracket-arm.left {
            border-left: 3px solid var(--vysus-stockholm-neon);
            border-bottom-left-radius: 6px;
        }

        .bracket-arm.right {
            border-right: 3px solid var(--vysus-stockholm-neon);
            border-bottom-right-radius: 6px;
        }

        .bracket-stem {
            width: 3px;
            height: 30px;
            background: var(--vysus-stockholm-neon);
            position: absolute;
            left: 50%;
            top: 16px;
        }

        .bracket-message {
            margin-top: 16px;
            padding: 24px 30px;
            background: var(--vysus-oslo-snow);
            border-left: 4px solid var(--vysus-stockholm-neon);
            max-width: 100%;
        }

        .bracket-message p {
            font-size: 14px;
            color: var(--vysus-scandinavia-rock);
            line-height: 1.6;
            font-style: italic;
        }

        /* Question Level Tags - vertical right side */
        .question-levels {
            display: none;
        }

        .question-sidebar {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 90px;
            align-items: stretch;
        }

        .level-tag {
            padding: 6px 12px;
            font-size: 11px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-align: center;
        }

        .level-tag.senior {
            background: var(--vysus-stavanger-ice);
            color: var(--vysus-scandinavia-rock);
        }

        .level-tag.lead {
            background: rgba(0, 227, 169, 0.3);
            color: var(--vysus-malmo-green);
        }

        .level-tag.principal {
            background: var(--vysus-stockholm-neon);
            color: var(--vysus-malmo-green);
            font-weight: 500;
        }

        /* Section Styling */
        .section {
            margin-bottom: 60px;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--vysus-stavanger-ice);
        }

        .section-number {
            background: var(--vysus-stockholm-neon);
            color: var(--vysus-malmo-green);
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 400;
        }

        .section-title {
            color: var(--vysus-malmo-green);
            font-size: 28px;
            font-weight: 400;
        }

        /* Question Cards */
        .question-card {
            background: var(--vysus-white);
            border: 1px solid var(--vysus-bergen-rain);
            margin-bottom: 24px;
            transition: box-shadow 0.3s ease;
        }

        .question-card:hover {
            box-shadow: 0 4px 20px rgba(0, 84, 84, 0.1);
        }

        .question-header {
            background: var(--vysus-malmo-green);
            color: var(--vysus-white);
            padding: 20px 24px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .question-id {
            background: var(--vysus-stockholm-neon);
            color: var(--vysus-malmo-green);
            padding: 4px 12px;
            font-size: 14px;
            font-weight: 400;
        }

        .question-text {
            font-size: 16px;
            font-weight: 300;
            flex: 1;
        }

        .question-body {
            padding: 20px 24px;
            display: flex;
            gap: 24px;
        }

        .question-content {
            flex: 1;
        }

        .question-right {
            display: flex;
            gap: 16px;
        }

        .listen-for {
            margin-bottom: 0;
        }

        .listen-for h4 {
            color: var(--vysus-malmo-green);
            font-size: 13px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .listen-for ul {
            list-style: none;
            padding-left: 0;
        }

        .listen-for li {
            padding: 5px 0 5px 20px;
            position: relative;
            color: var(--vysus-scandinavia-rock);
            font-size: 14px;
            line-height: 1.4;
        }

        .listen-for li::before {
            content: '';
            position: absolute;
            left: 0;
            top: 12px;
            width: 6px;
            height: 6px;
            background: var(--vysus-stockholm-neon);
        }

        /* Flags - compact right side */
        .flags {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 180px;
        }

        .flag-box {
            padding: 10px 12px;
        }

        .flag-box.green {
            background: rgba(0, 227, 169, 0.1);
            border-left: 3px solid var(--vysus-stockholm-neon);
        }

        .flag-box.red {
            background: rgba(249, 45, 99, 0.1);
            border-left: 3px solid #F92D63;
        }

        .flag-box h5 {
            font-size: 10px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 4px;
        }

        .flag-box.green h5 {
            color: var(--vysus-malmo-green);
        }

        .flag-box.red h5 {
            color: #F92D63;
        }

        .flag-box p {
            font-size: 12px;
            color: var(--vysus-trondheim-night);
            line-height: 1.3;
        }

        @media (max-width: 900px) {
            .question-body {
                flex-direction: column;
            }

            .question-right {
                flex-direction: row;
            }

            .flags {
                min-width: auto;
                flex: 1;
            }

            .question-sidebar {
                flex-direction: row;
                min-width: auto;
            }
        }

        /* Reference Table */
        .reference-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .reference-table th {
            background: var(--vysus-malmo-green);
            color: var(--vysus-white);
            padding: 16px 20px;
            text-align: left;
            font-weight: 400;
            font-size: 14px;
        }

        .reference-table td {
            padding: 16px 20px;
            border-bottom: 1px solid var(--vysus-stavanger-ice);
            font-size: 14px;
            color: var(--vysus-scandinavia-rock);
            line-height: 1.4;
        }

        .reference-table tr:nth-child(even) {
            background: var(--vysus-oslo-snow);
        }

        .reference-table .trait {
            color: var(--vysus-malmo-green);
            font-weight: 400;
        }

        /* Scoring Section */
        .scoring-card {
            background: var(--vysus-oslo-snow);
            padding: 40px;
            margin-top: 40px;
        }

        .scoring-card h3 {
            color: var(--vysus-malmo-green);
            font-size: 24px;
            font-weight: 400;
            margin-bottom: 24px;
        }

        .score-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .score-item {
            display: flex;
            align-items: center;
            gap: 16px;
            background: var(--vysus-white);
            padding: 16px 20px;
            border: 1px solid var(--vysus-bergen-rain);
        }

        .score-item label {
            flex: 1;
            color: var(--vysus-trondheim-night);
            font-size: 15px;
        }

        .score-input {
            width: 60px;
            padding: 8px 12px;
            border: 2px solid var(--vysus-bergen-rain);
            font-size: 16px;
            text-align: center;
            font-family: var(--vysus-font-primary);
        }

        .score-input:focus {
            outline: none;
            border-color: var(--vysus-stockholm-neon);
        }

        /* Per-question scoring - one-click buttons */
        .question-score {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 12px 24px;
            background: var(--vysus-oslo-snow);
            border-top: 1px solid var(--vysus-bergen-rain);
        }

        .score-btn {
            padding: 8px 16px;
            border: 2px solid var(--vysus-bergen-rain);
            background: var(--vysus-white);
            font-size: 12px;
            font-family: var(--vysus-font-primary);
            cursor: pointer;
            transition: all 0.15s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .score-btn:hover {
            border-color: var(--vysus-scandinavia-rock);
        }

        .score-btn.concern {
            color: #F92D63;
        }

        .score-btn.concern.selected {
            background: rgba(249, 45, 99, 0.15);
            border-color: #F92D63;
            color: #F92D63;
        }

        .score-btn.ok {
            color: var(--vysus-scandinavia-rock);
        }

        .score-btn.ok.selected {
            background: rgba(0, 84, 84, 0.1);
            border-color: var(--vysus-malmo-green);
            color: var(--vysus-malmo-green);
        }

        .score-btn.strong {
            color: var(--vysus-malmo-green);
        }

        .score-btn.strong.selected {
            background: rgba(0, 227, 169, 0.2);
            border-color: var(--vysus-stockholm-neon);
            color: var(--vysus-malmo-green);
        }

        /* Score dots indicator on question header */
        .score-dots {
            display: flex;
            gap: 4px;
            margin-left: auto;
            align-items: center;
        }

        .score-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255,255,255,0.25);
            transition: all 0.2s;
        }

        .score-dots[data-score="1"] .score-dot:nth-child(1) {
            background: #F92D63;
        }

        .score-dots[data-score="3"] .score-dot:nth-child(1),
        .score-dots[data-score="3"] .score-dot:nth-child(2),
        .score-dots[data-score="3"] .score-dot:nth-child(3) {
            background: rgba(255,255,255,0.8);
        }

        .score-dots[data-score="5"] .score-dot {
            background: var(--vysus-stockholm-neon);
        }

        /* Fixed bottom scoring bar */
        .scoring-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: var(--vysus-white);
            z-index: 100;
            padding: 16px 24px;
            border-top: 3px solid var(--vysus-stockholm-neon);
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            display: none;
            max-height: 60vh;
            overflow-y: auto;
        }

        .scoring-bar.visible {
            display: block;
        }

        .scoring-bar-inner {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .candidate-name-input {
            padding: 10px 16px;
            border: 2px solid var(--vysus-bergen-rain);
            font-size: 15px;
            font-family: var(--vysus-font-primary);
            width: 200px;
        }

        .candidate-name-input:focus {
            outline: none;
            border-color: var(--vysus-stockholm-neon);
        }

        .score-chips {
            display: flex;
            gap: 12px;
            align-items: center;
            flex: 1;
        }

        .score-chip {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: var(--vysus-oslo-snow);
            font-size: 13px;
        }

        .score-chip .chip-label {
            color: var(--vysus-scandinavia-rock);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 11px;
        }

        .score-chip .chip-value {
            font-size: 16px;
            font-weight: 400;
            color: var(--vysus-malmo-green);
        }

        .score-chip.total {
            background: var(--vysus-stockholm-neon);
            padding: 8px 16px;
        }

        .score-chip.total .chip-value {
            font-size: 20px;
            font-weight: 500;
        }

        .pass-fail-indicator {
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .pass-fail-indicator.pass {
            background: rgba(0, 227, 169, 0.2);
            color: var(--vysus-malmo-green);
        }

        .pass-fail-indicator.fail {
            background: rgba(249, 45, 99, 0.15);
            color: #F92D63;
        }

        .pass-fail-indicator.pending {
            background: var(--vysus-stavanger-ice);
            color: var(--vysus-scandinavia-rock);
        }

        .bar-actions {
            display: flex;
            gap: 8px;
        }

        .bar-btn {
            padding: 10px 20px;
            border: none;
            font-size: 12px;
            font-family: var(--vysus-font-primary);
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .bar-btn.save {
            background: var(--vysus-malmo-green);
            color: var(--vysus-white);
        }

        .bar-btn.save:hover {
            background: var(--vysus-trondheim-night);
        }

        .bar-btn.email {
            background: var(--vysus-stavanger-ice);
            color: var(--vysus-malmo-green);
        }

        .bar-btn.email:hover {
            background: var(--vysus-bergen-rain);
        }

        /* Candidate Summary Panel */
        .summary-panel {
            display: none;
            width: 100%;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--vysus-bergen-rain);
        }

        .summary-panel.visible {
            display: block;
        }

        .summary-content {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 16px;
        }

        .summary-block {
            padding: 16px;
            background: var(--vysus-oslo-snow);
        }

        .summary-block h5 {
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            color: var(--vysus-malmo-green);
        }

        .summary-block.strengths {
            border-left: 3px solid var(--vysus-stockholm-neon);
        }

        .summary-block.concerns {
            border-left: 3px solid #F92D63;
        }

        .summary-block.recommendation {
            border-left: 3px solid var(--vysus-malmo-green);
        }

        .summary-block ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .summary-block li {
            font-size: 13px;
            color: var(--vysus-scandinavia-rock);
            padding: 3px 0;
        }

        .summary-block .rec-level {
            font-size: 18px;
            font-weight: 400;
            color: var(--vysus-malmo-green);
            margin-bottom: 8px;
        }

        .summary-block .rec-reasoning {
            font-size: 13px;
            color: var(--vysus-scandinavia-rock);
            line-height: 1.5;
        }

        .summary-block .rec-caution {
            margin-top: 8px;
            font-size: 12px;
            color: #F92D63;
            font-style: italic;
        }

        @media (max-width: 900px) {
            .summary-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 900px) {
            .scoring-bar-inner {
                flex-direction: column;
                align-items: stretch;
            }

            .score-chips {
                flex-wrap: wrap;
            }

            .candidate-name-input {
                width: 100%;
            }
        }

        .pass-criteria {
            background: var(--vysus-stockholm-neon);
            color: var(--vysus-malmo-green);
            padding: 16px 24px;
            font-size: 15px;
            font-weight: 400;
        }

        /* Admin Panel */
        .admin-panel {
            display: none;
            background: var(--vysus-trondheim-night);
            border: 2px solid var(--vysus-stockholm-neon);
            margin-bottom: 40px;
        }

        .admin-panel.visible {
            display: block;
        }

        .admin-panel-header {
            background: var(--vysus-malmo-green);
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .admin-panel-header h3 {
            color: var(--vysus-stockholm-neon);
            font-size: 16px;
            font-weight: 400;
        }

        .admin-panel-header span {
            color: var(--vysus-stockholm-neon);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .admin-panel-body {
            padding: 20px 24px;
            display: none;
            max-height: 500px;
            overflow-y: auto;
        }

        .admin-panel-body.open {
            display: block;
        }

        .admin-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .admin-tab {
            padding: 8px 16px;
            background: transparent;
            border: 1px solid rgba(255,255,255,0.2);
            color: rgba(255,255,255,0.6);
            font-size: 12px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: inherit;
        }

        .admin-tab.active {
            background: var(--vysus-stockholm-neon);
            color: var(--vysus-malmo-green);
            border-color: var(--vysus-stockholm-neon);
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
        }

        .admin-table th {
            text-align: left;
            padding: 10px 12px;
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--vysus-stockholm-neon);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .admin-table td {
            padding: 8px 12px;
            font-size: 13px;
            color: rgba(255,255,255,0.8);
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .admin-table tr:hover td {
            background: rgba(0, 227, 169, 0.05);
        }

        /* Footer */
        .footer {
            background: var(--vysus-trondheim-night);
            color: var(--vysus-white);
            padding: 40px;
            text-align: center;
        }

        .footer p {
            font-size: 14px;
            opacity: 0.7;
        }

        .footer .tagline {
            color: var(--vysus-stockholm-neon);
            font-size: 16px;
            font-weight: 400;
            margin-top: 16px;
            letter-spacing: 2px;
            opacity: 1;
        }

        /* Print Styles */
        @media print {
            .header {
                padding: 40px;
            }

            .question-card {
                break-inside: avoid;
            }

            .score-input {
                border: 1px solid var(--vysus-trondheim-night);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 32px;
            }

            .flags {
                grid-template-columns: 1fr;
            }

            .score-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Resume Analyzer Inline */
        .analyzer-section {
            background: var(--vysus-white);
            border: 2px solid var(--vysus-bergen-rain);
            margin-bottom: 40px;
        }

        .analyzer-header {
            background: var(--vysus-malmo-green);
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .analyzer-header h3 {
            color: var(--vysus-white);
            font-size: 18px;
            font-weight: 400;
        }

        .analyzer-toggle {
            color: var(--vysus-stockholm-neon);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .analyzer-body {
            padding: 24px;
            display: none;
        }

        .analyzer-body.open {
            display: block;
        }

        .analyzer-upload {
            border: 2px dashed var(--vysus-bergen-rain);
            padding: 30px;
            text-align: center;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .analyzer-upload.dragover {
            border-color: var(--vysus-stockholm-neon);
            background: rgba(0, 227, 169, 0.05);
        }

        .analyzer-upload p {
            color: var(--vysus-scandinavia-rock);
            font-size: 14px;
            margin-bottom: 12px;
        }

        .analyzer-form-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 16px;
            align-items: end;
        }

        .analyzer-form-row .form-group label {
            display: block;
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--vysus-malmo-green);
            margin-bottom: 6px;
        }

        .analyzer-form-row .form-group input,
        .analyzer-form-row .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid var(--vysus-bergen-rain);
            font-size: 14px;
            font-family: inherit;
        }

        .analyzer-form-row .form-group input:focus,
        .analyzer-form-row .form-group select:focus {
            outline: none;
            border-color: var(--vysus-stockholm-neon);
        }

        .analyze-btn-inline {
            padding: 10px 24px;
            background: var(--vysus-stockholm-neon);
            color: var(--vysus-malmo-green);
            font-size: 13px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
            transition: all 0.3s;
            height: 42px;
        }

        .analyze-btn-inline:hover {
            background: var(--vysus-malmo-green);
            color: var(--vysus-white);
        }

        .analyze-btn-inline:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .upload-btn-sm {
            padding: 10px 24px;
            background: var(--vysus-stockholm-neon);
            color: var(--vysus-malmo-green);
            font-size: 13px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .upload-btn-sm:hover {
            background: var(--vysus-malmo-green);
            color: var(--vysus-white);
        }

        .file-selected {
            margin-top: 12px;
            font-size: 13px;
            color: var(--vysus-malmo-green);
            display: none;
        }

        .file-selected.visible {
            display: block;
        }

        /* AI Summary Result */
        .ai-result {
            display: none;
            margin-top: 20px;
            padding: 24px;
            background: var(--vysus-oslo-snow);
            border-left: 4px solid var(--vysus-stockholm-neon);
        }

        .ai-result.visible {
            display: block;
        }

        .ai-result h4 {
            color: var(--vysus-malmo-green);
            font-size: 14px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        .ai-result p {
            color: var(--vysus-scandinavia-rock);
            font-size: 14px;
            line-height: 1.7;
            margin-bottom: 8px;
        }

        .ai-result .score-badge {
            display: inline-block;
            padding: 6px 16px;
            font-size: 16px;
            font-weight: 500;
            margin-right: 12px;
            margin-bottom: 12px;
        }

        .ai-result .score-badge.overall {
            background: var(--vysus-stockholm-neon);
            color: var(--vysus-malmo-green);
        }

        .ai-result .score-badge.level {
            background: var(--vysus-malmo-green);
            color: var(--vysus-white);
        }

        .strengths-gaps {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 16px;
        }

        .strengths-gaps ul {
            list-style: none;
            padding: 0;
        }

        .strengths-gaps li {
            padding: 4px 0;
            font-size: 13px;
            color: var(--vysus-scandinavia-rock);
            padding-left: 16px;
            position: relative;
        }

        .strengths-gaps li::before {
            content: '';
            position: absolute;
            left: 0;
            top: 10px;
            width: 6px;
            height: 6px;
        }

        .strengths-list li::before {
            background: var(--vysus-stockholm-neon);
        }

        .gaps-list li::before {
            background: #F92D63;
        }

        .strengths-gaps h5 {
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .strengths-list h5 { color: var(--vysus-malmo-green); }
        .gaps-list h5 { color: #F92D63; }

        /* Analyzing overlay inline */
        .analyzing-indicator {
            display: none;
            text-align: center;
            padding: 30px;
        }

        .analyzing-indicator.visible {
            display: block;
        }

        .analyzing-indicator .spinner-inline {
            width: 40px;
            height: 40px;
            border: 3px solid var(--vysus-bergen-rain);
            border-top-color: var(--vysus-stockholm-neon);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 12px;
        }

        .analyzing-indicator p {
            color: var(--vysus-scandinavia-rock);
            font-size: 14px;
        }

        /* Skill highlighting on role cards */
        .role-card-body li.skill-strong {
            color: var(--vysus-malmo-green);
            font-weight: 400;
            background: rgba(0, 227, 169, 0.12);
            padding: 8px 10px;
            margin: 2px -10px;
            animation: skillPulse 2.5s ease-in-out infinite;
        }

        .role-card-body li.skill-strong::before {
            background: var(--vysus-stockholm-neon);
            width: 10px;
            height: 10px;
            margin-top: 4px;
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(0, 227, 169, 0.6);
        }

        .role-card-body li.skill-partial {
            color: #856404;
            background: rgba(255, 193, 7, 0.08);
            padding: 8px 10px;
            margin: 2px -10px;
        }

        .role-card-body li.skill-partial::before {
            background: #ffc107;
            width: 8px;
            height: 8px;
            margin-top: 5px;
        }

        .role-card-body li.skill-none-checked {
            opacity: 0.5;
        }

        @keyframes skillPulse {
            0%, 100% { background: rgba(0, 227, 169, 0.12); }
            50% { background: rgba(0, 227, 169, 0.25); }
        }

        /* Disclaimer */
        .disclaimer {
            background: rgba(249, 45, 99, 0.06);
            border-left: 4px solid rgba(249, 45, 99, 0.4);
            padding: 16px 20px;
            margin-bottom: 30px;
        }

        .disclaimer p {
            color: var(--vysus-scandinavia-rock);
            font-size: 13px;
            line-height: 1.6;
        }

        .disclaimer strong {
            color: var(--vysus-malmo-green);
        }

        @media (max-width: 900px) {
            .analyzer-form-row {
                grid-template-columns: 1fr;
            }
            .strengths-gaps {
                grid-template-columns: 1fr;
            }
        }

        /* Password Protection Overlay */
        .password-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--vysus-malmo-green);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .password-box {
            background: var(--vysus-white);
            padding: 60px;
            max-width: 400px;
            text-align: center;
        }

        .password-box svg {
            width: 60px;
            margin-bottom: 30px;
        }

        .password-box h2 {
            color: var(--vysus-malmo-green);
            font-size: 24px;
            font-weight: 400;
            margin-bottom: 8px;
        }

        .password-box p {
            color: var(--vysus-scandinavia-rock);
            font-size: 14px;
            margin-bottom: 30px;
        }

        .password-input {
            width: 100%;
            padding: 16px;
            border: 2px solid var(--vysus-bergen-rain);
            font-size: 16px;
            font-family: var(--vysus-font-primary);
            margin-bottom: 16px;
            text-align: center;
        }

        .password-input:focus {
            outline: none;
            border-color: var(--vysus-stockholm-neon);
        }

        .password-btn {
            width: 100%;
            padding: 16px;
            background: var(--vysus-stockholm-neon);
            color: var(--vysus-malmo-green);
            border: none;
            font-size: 16px;
            font-weight: 400;
            font-family: var(--vysus-font-primary);
            cursor: pointer;
            transition: background 0.3s;
        }

        .password-btn:hover {
            background: var(--vysus-malmo-green);
            color: var(--vysus-white);
        }

        .password-error {
            color: #F92D63;
            font-size: 14px;
            margin-top: 16px;
            display: none;
        }

        .protected-content {
            display: none;
        }

        .protected-content.unlocked {
            display: block;
        }
    </style>
</head>
<body>
    <div class="password-overlay" id="passwordOverlay">
        <div class="password-box">
            <svg viewBox="0 0 100 112" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0 L38.7 112.2 L85 112.2 L46.2 0 Z" fill="#00E3A9"/>
                <path d="M86.2 2.8 L74.8 10.9 L67.6 22.6 L65.7 36.1 L68.5 48.1 L76.9 59.8 L88.2 66.6 L100 68.6 L100 0 Z" fill="#00E3A9"/>
            </svg>
            <h2 id="authTitle">Checking Authentication...</h2>
            <p id="authSubtitle">Please wait while we verify your access.</p>
            <div id="loginPrompt" style="display: none;">
                <a href="/login.html" class="password-btn" style="display: inline-block; text-decoration: none; margin-top: 20px;">Sign In</a>
            </div>
        </div>
    </div>

    <div class="protected-content" id="protectedContent">
    <header class="header">
        <div class="header-content">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
                <div class="logo">
                    <svg class="vysus-marque" viewBox="0 0 100 112" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0 0 L38.7 112.2 L85 112.2 L46.2 0 Z" fill="#00E3A9"/>
                        <path d="M86.2 2.8 L74.8 10.9 L67.6 22.6 L65.7 36.1 L68.5 48.1 L76.9 59.8 L88.2 66.6 L100 68.6 L100 0 Z" fill="#00E3A9"/>
                    </svg>
                    <span class="logo-text">VYSUS GROUP</span>
                </div>
                <div id="userInfo" style="text-align: right; color: var(--vysus-white); font-size: 13px;">
                    <span id="userEmail" style="opacity: 0.8;"></span>
                    <div style="margin-top: 8px;">
                        <a href="/candidates.html" style="color: var(--vysus-stockholm-neon); text-decoration: none; margin-right: 16px; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Candidates</a>
                        <a href="/admin.html" id="adminGear" style="display: none; color: var(--vysus-stockholm-neon); text-decoration: none; margin-right: 16px; font-size: 18px; vertical-align: middle;" title="Admin Dashboard">&#9881;</a>
                        <button onclick="handleSignOut()" style="background: transparent; border: 1px solid rgba(255,255,255,0.3); color: var(--vysus-white); padding: 6px 12px; font-size: 11px; cursor: pointer; text-transform: uppercase; letter-spacing: 0.5px;">Sign Out</button>
                    </div>
                </div>
            </div>
            <h1>Recruiter Pre-Screening Guide</h1>
            <p class="subtitle">Grid Connection Engineer Candidates</p>
        </div>
    </header>

    <main class="main">
        <div class="intro">
            <h2>How to Use This Guide</h2>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 16px;">
                <div style="padding: 16px; background: var(--vysus-white); border-top: 3px solid var(--vysus-stockholm-neon);">
                    <div style="font-size: 28px; font-weight: 300; color: var(--vysus-stockholm-neon); margin-bottom: 8px;">1</div>
                    <div style="font-size: 14px; font-weight: 500; color: var(--vysus-malmo-green); margin-bottom: 6px;">Upload Resume</div>
                    <p style="font-size: 13px; color: var(--vysus-scandinavia-rock); line-height: 1.5;">Upload the candidate's CV (PDF, DOC, or TXT). The tool will auto-detect their name and email.</p>
                </div>
                <div style="padding: 16px; background: var(--vysus-white); border-top: 3px solid var(--vysus-stockholm-neon);">
                    <div style="font-size: 28px; font-weight: 300; color: var(--vysus-stockholm-neon); margin-bottom: 8px;">2</div>
                    <div style="font-size: 14px; font-weight: 500; color: var(--vysus-malmo-green); margin-bottom: 6px;">AI Summary Generated</div>
                    <p style="font-size: 13px; color: var(--vysus-scandinavia-rock); line-height: 1.5;">An AI-powered analysis scores the resume against Senior, Lead, and Principal Engineer role profiles, highlighting strengths and gaps.</p>
                </div>
                <div style="padding: 16px; background: var(--vysus-white); border-top: 3px solid var(--vysus-stockholm-neon);">
                    <div style="font-size: 28px; font-weight: 300; color: var(--vysus-stockholm-neon); margin-bottom: 8px;">3</div>
                    <div style="font-size: 14px; font-weight: 500; color: var(--vysus-malmo-green); margin-bottom: 6px;">Ask Screening Questions</div>
                    <p style="font-size: 13px; color: var(--vysus-scandinavia-rock); line-height: 1.5;">Use the 9 questions below during your call. Score each answer - results auto-save and can be emailed to the team.</p>
                </div>
            </div>
            <p style="margin-top: 16px; font-size: 13px; color: var(--vysus-scandinavia-rock); line-height: 1.5;">Listen for <strong>confidence</strong>, <strong>clarity</strong>, and <strong>relevant experience</strong>. Red flags include vague answers, blaming others, or inability to explain concepts simply.</p>
        </div>

        <!-- My Screenings - visible to all logged-in users (own data only) -->
        <div class="admin-panel" id="userPanel">
            <div class="admin-panel-header" onclick="toggleUserPanel()">
                <h3>My Screenings</h3>
                <span id="userToggle">View</span>
            </div>
            <div class="admin-panel-body" id="userBody">
                <div class="admin-tabs">
                    <button class="admin-tab active" onclick="showUserTab('myScreenings', this)">My Screening Results</button>
                    <button class="admin-tab" onclick="showUserTab('myAnalyses', this)">My Resume Analyses</button>
                </div>
                <div id="userContent">
                    <p style="color: rgba(255,255,255,0.5); font-size: 13px;">Loading...</p>
                </div>
            </div>
        </div>

        <div class="disclaimer">
            <p><strong>Important:</strong> This tool is designed to support and expedite the screening process, enabling more comprehensive candidate evaluation and increasing successful hiring outcomes for Vysus. It does not replace the deeper, intangible assessment that comes through recruiter conversations and team interviews. Technical capability, cultural alignment, and leadership presence must be validated through direct engagement with the candidate.</p>
        </div>

        <div style="background: rgba(0, 227, 169, 0.08); border-left: 4px solid var(--vysus-stockholm-neon); padding: 16px 20px; margin-bottom: 30px;">
            <p style="font-size: 13px; color: var(--vysus-scandinavia-rock); line-height: 1.6; margin: 0;">
                <strong style="color: var(--vysus-malmo-green);">Data Security:</strong>
                This tool uses <strong>Supabase with Row Level Security (RLS)</strong>. All screening data, resume analyses, and candidate assessments are stored securely and are only accessible to your authenticated account. Your data is not shared with other users. Authentication is handled via passwordless magic link email verification. API keys are stored server-side only.
            </p>
        </div>

        <!-- Resume Analyzer -->
        <div class="analyzer-section">
            <div class="analyzer-header" onclick="toggleAnalyzer()">
                <h3>Resume Analyzer</h3>
                <span class="analyzer-toggle" id="analyzerToggle">Upload Resume</span>
            </div>
            <div class="analyzer-body" id="analyzerBody">
                <div class="analyzer-upload" id="analyzerUpload">
                    <p>Drop a resume here, or click to select a file (PDF, DOC, DOCX, TXT)</p>
                    <input type="file" id="resumeFileInput" accept=".pdf,.doc,.docx,.txt" style="display:none">
                    <button class="upload-btn-sm" onclick="document.getElementById('resumeFileInput').click()">Choose File</button>
                    <div class="file-selected" id="fileSelected"><strong>Selected:</strong> <span id="selectedFileName"></span></div>
                </div>
                <div class="analyzer-form-row">
                    <div class="form-group">
                        <label for="resumeCandidateName">Candidate Name</label>
                        <input type="text" id="resumeCandidateName" placeholder="Auto-detected from resume">
                    </div>
                    <div class="form-group">
                        <label for="resumeCandidateEmail">Candidate Email</label>
                        <input type="email" id="resumeCandidateEmail" placeholder="Auto-detected from resume">
                    </div>
                    <div class="form-group">
                        <label for="resumeTargetPosition">Target Position</label>
                        <select id="resumeTargetPosition">
                            <option value="Senior">Senior Engineer</option>
                            <option value="Lead">Lead Engineer</option>
                            <option value="Principal">Principal Engineer</option>
                        </select>
                    </div>
                    <button class="analyze-btn-inline" id="analyzeResumeBtn" onclick="runAnalysis()" disabled>Analyze</button>
                </div>
                <div id="interviewCheckResult" style="display: none; padding: 12px 16px; margin-top: 12px; font-size: 13px; line-height: 1.5;"></div>
                <div class="analyzing-indicator" id="analyzingIndicator">
                    <div class="spinner-inline"></div>
                    <p>Analyzing resume against role requirements...</p>
                </div>
                <div class="ai-result" id="aiResult">
                    <h4>AI Analysis Summary</h4>
                    <div id="aiScoreBadges"></div>
                    <p id="aiSummaryText"></p>
                    <div class="strengths-gaps">
                        <div class="strengths-list">
                            <h5>Key Strengths</h5>
                            <ul id="aiStrengths"></ul>
                        </div>
                        <div class="gaps-list">
                            <h5>Development Areas</h5>
                            <ul id="aiGaps"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recently Analyzed Candidates -->
        <div id="recentAnalysesSection" style="display: none; margin-bottom: 30px;">
            <div style="background: var(--vysus-malmo-green); padding: 16px 20px; display: flex; justify-content: space-between; align-items: center; cursor: pointer;" onclick="toggleRecentAnalyses()">
                <h3 style="color: var(--vysus-white); font-size: 16px; font-weight: 400; margin: 0;">Recently Analyzed Candidates</h3>
                <span id="recentAnalysesToggle" style="color: var(--vysus-stockholm-neon); font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">View</span>
            </div>
            <div id="recentAnalysesBody" style="display: none; background: var(--vysus-oslo-snow); max-height: 300px; overflow-y: auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: var(--vysus-stavanger-ice);">
                            <th style="padding: 10px 16px; text-align: left; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--vysus-malmo-green);">Candidate</th>
                            <th style="padding: 10px 16px; text-align: left; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--vysus-malmo-green);">Email</th>
                            <th style="padding: 10px 16px; text-align: left; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--vysus-malmo-green);">Position</th>
                            <th style="padding: 10px 16px; text-align: left; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--vysus-malmo-green);">Score</th>
                            <th style="padding: 10px 16px; text-align: left; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--vysus-malmo-green);">Date</th>
                        </tr>
                    </thead>
                    <tbody id="recentAnalysesList">
                        <tr><td colspan="5" style="padding: 20px; text-align: center; color: var(--vysus-bergen-rain); font-size: 13px;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Fixed Bottom Scoring Bar -->
        <div class="scoring-bar" id="scoringBar">
            <div class="scoring-bar-inner">
                <input type="text" class="candidate-name-input" id="candidateName" placeholder="Candidate Name">
                <div class="score-chips">
                    <div class="score-chip">
                        <span class="chip-label">Conf</span>
                        <span class="chip-value" id="confidenceTotal">0/10</span>
                    </div>
                    <div class="score-chip">
                        <span class="chip-label">Lead</span>
                        <span class="chip-value" id="leadershipTotal">0/15</span>
                    </div>
                    <div class="score-chip">
                        <span class="chip-label">Tech</span>
                        <span class="chip-value" id="technicalTotal">0/20</span>
                    </div>
                    <div class="score-chip total">
                        <span class="chip-label">Total</span>
                        <span class="chip-value" id="grandTotal">0/45</span>
                    </div>
                    <div class="pass-fail-indicator pending" id="passFail">Scoring...</div>
                </div>
                <div class="bar-actions">
                    <span id="autoSaveStatus" style="font-size: 11px; color: var(--vysus-scandinavia-rock); padding: 10px 8px;"></span>
                    <button class="bar-btn email" onclick="emailResults()">Email</button>
                </div>
                <div class="summary-panel" id="summaryPanel">
                    <div class="summary-content">
                        <div class="summary-block strengths">
                            <h5>Strengths</h5>
                            <ul id="strengthsList"></ul>
                        </div>
                        <div class="summary-block concerns">
                            <h5>Concerns</h5>
                            <ul id="concernsList"></ul>
                        </div>
                        <div class="summary-block recommendation">
                            <h5>Recommended Level</h5>
                            <div class="rec-level" id="recLevel">-</div>
                            <div class="rec-reasoning" id="recReasoning"></div>
                            <div class="rec-caution" id="recCaution"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Role Progression -->
        <div class="role-progression">
            <div class="role-card">
                <div class="role-card-header">
                    <h3>Senior Engineer</h3>
                    <div class="focus">Technical Delivery</div>
                </div>
                <div class="role-card-body">
                    <ul id="senior-skills">
                        <li class="new-skill" data-skill="senior-0">Independent study delivery (R1/R2)</li>
                        <li class="new-skill" data-skill="senior-1">Strong in 1-2 modelling tools (PSCAD, PSS/E)</li>
                        <li class="new-skill" data-skill="senior-2">EMT & RMS simulation execution</li>
                        <li class="new-skill" data-skill="senior-3">Grid code compliance assessment</li>
                        <li class="new-skill" data-skill="senior-4">Model validation & tuning</li>
                        <li class="new-skill" data-skill="senior-5">Technical report writing</li>
                        <li data-skill="senior-6">Developing client communication</li>
                        <li data-skill="senior-7">Contributes to team knowledge</li>
                    </ul>
                </div>
            </div>

            <div class="role-card lead" id="leadCard">
                <div class="role-card-header">
                    <h3>Lead Engineer</h3>
                    <div class="focus">Technical Leadership</div>
                </div>
                <div class="role-card-body">
                    <ul id="lead-skills">
                        <li>All Senior responsibilities plus:</li>
                        <li class="new-skill" data-skill="lead-0">Mentors and develops engineers</li>
                        <li class="new-skill" data-skill="lead-1">Project leadership & oversight</li>
                        <li class="new-skill" data-skill="lead-2">Direct NSP/AEMO engagement</li>
                        <li class="new-skill" data-skill="lead-3">Project budget management</li>
                        <li class="new-skill" data-skill="lead-4">Client relationship ownership</li>
                        <li class="new-skill" data-skill="lead-5">Technical review & QA sign-off</li>
                        <li class="new-skill" data-skill="lead-6">Scope definition & proposal input</li>
                        <li class="new-skill" data-skill="lead-7">Multi-project coordination</li>
                        <li class="new-skill" data-skill="lead-8">Technical risk assessment</li>
                    </ul>
                </div>
            </div>

            <div class="role-card principal" id="principalCard">
                <div class="role-card-header">
                    <h3>Principal Engineer</h3>
                    <div class="focus">Strategic Leadership</div>
                </div>
                <div class="role-card-body">
                    <ul id="principal-skills">
                        <li>All Lead responsibilities plus:</li>
                        <li class="new-skill" data-skill="principal-0">Strategic oversight across projects</li>
                        <li class="new-skill" data-skill="principal-1">Business development & growth</li>
                        <li class="new-skill" data-skill="principal-2">Senior client advisory</li>
                        <li class="new-skill" data-skill="principal-3">Team capacity & capability planning</li>
                        <li class="new-skill" data-skill="principal-4">Guides Leads on complex decisions</li>
                        <li class="new-skill" data-skill="principal-5">Industry thought leadership</li>
                        <li class="new-skill" data-skill="principal-6">Proposal strategy & pricing oversight</li>
                        <li class="new-skill" data-skill="principal-7">Market positioning & service offering</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Leadership expectation bracket -->
        <div class="leadership-bracket">
            <div class="bracket-visual">
                <div class="bracket-arm left"></div>
                <div class="bracket-stem"></div>
                <div class="bracket-arm right"></div>
            </div>
            <div class="bracket-message">
                <p>Our Leads and Principals don't just manage work - they drive it. They bring personal investment to every project, set the standard for technical excellence, and lift the people around them. We're looking for engineers who go beyond the brief because they genuinely care about the outcome - people who are strong within themselves, back their expertise, and lead by example. That's what sets our people apart.</p>
            </div>
        </div>

        <!-- Part 1: Confidence -->
        <section class="section">
            <div class="section-header">
                <div class="section-number">1</div>
                <h2 class="section-title">Confidence Indicators</h2>
            </div>

            <div class="question-card">
                <div class="question-header">
                    <span class="question-id">Q1</span>
                    <span class="question-text">"Tell me about the most complex grid connection project you've worked on."</span>
                </div>
                <div class="question-body">
                    <div class="question-content">
                        <div class="listen-for">
                            <h4>Listen For</h4>
                            <ul>
                                <li>Do they own their contribution or hide behind the team?</li>
                                <li>Can they explain it simply without jargon-dumping?</li>
                                <li>Do they mention specific outcomes (MW size, timeframes, challenges overcome)?</li>
                            </ul>
                        </div>
                    </div>
                    <div class="question-right">
                        <div class="flags">
                            <div class="flag-box green">
                                <h5>Green</h5>
                                <p>"I led...", "We faced X and I solved it by..."</p>
                            </div>
                            <div class="flag-box red">
                                <h5>Red</h5>
                                <p>Vague, can't quantify, blames others</p>
                            </div>
                        </div>
                        <div class="question-sidebar">
                            <span class="level-tag principal">Principal</span>
                            <span class="level-tag lead">Lead</span>
                            <span class="level-tag senior">Senior</span>
                        </div>
                    </div>
                </div>
                <div class="question-score">
                    <button class="score-btn concern" data-category="confidence" data-value="1" onclick="selectScore(this)">Concern</button>
                    <button class="score-btn ok" data-category="confidence" data-value="3" onclick="selectScore(this)">OK</button>
                    <button class="score-btn strong" data-category="confidence" data-value="5" onclick="selectScore(this)">Strong</button>
                </div>
            </div>

            <div class="question-card">
                <div class="question-header">
                    <span class="question-id">Q2</span>
                    <span class="question-text">"What software tools are you most confident using?"</span>
                </div>
                <div class="question-body">
                    <div class="question-content">
                        <div class="listen-for">
                            <h4>Listen For</h4>
                            <ul>
                                <li>Specific tools: PSCAD, PSS/E, DIgSILENT, Python</li>
                                <li>Honest about gaps vs. overselling everything</li>
                                <li>Willingness to learn what they don't know</li>
                            </ul>
                        </div>
                    </div>
                    <div class="question-right">
                        <div class="flags">
                            <div class="flag-box green">
                                <h5>Green</h5>
                                <p>"Strong in X, learning Y, need training on Z"</p>
                            </div>
                            <div class="flag-box red">
                                <h5>Red</h5>
                                <p>Claims expert in everything, dismissive</p>
                            </div>
                        </div>
                        <div class="question-sidebar">
                            <span class="level-tag principal">Principal</span>
                            <span class="level-tag lead">Lead</span>
                            <span class="level-tag senior">Senior</span>
                        </div>
                    </div>
                </div>
                <div class="question-score">
                    <button class="score-btn concern" data-category="confidence" data-value="1" onclick="selectScore(this)">Concern</button>
                    <button class="score-btn ok" data-category="confidence" data-value="3" onclick="selectScore(this)">OK</button>
                    <button class="score-btn strong" data-category="confidence" data-value="5" onclick="selectScore(this)">Strong</button>
                </div>
            </div>
        </section>

        <!-- Part 2: Leadership -->
        <section class="section">
            <div class="section-header">
                <div class="section-number">2</div>
                <h2 class="section-title">Leadership & Management</h2>
            </div>

            <div class="question-card">
                <div class="question-header">
                    <span class="question-id">Q3</span>
                    <span class="question-text">"If two engineers on your team were struggling with a technical task and the deadline was tight, what would you do?"</span>
                </div>
                <div class="question-body">
                    <div class="question-content">
                        <div class="listen-for">
                            <h4>Good Answers Include</h4>
                            <ul>
                                <li>Pair them with experienced team members</li>
                                <li>Adjust timeline realistically</li>
                                <li>Take accountability for team delivery</li>
                            </ul>
                        </div>
                    </div>
                    <div class="question-right">
                        <div class="flags">
                            <div class="flag-box green">
                                <h5>Green</h5>
                                <p>Mentoring mindset, realistic, takes ownership</p>
                            </div>
                            <div class="flag-box red">
                                <h5>Red</h5>
                                <p>"I'd do it myself" or "Replace them"</p>
                            </div>
                        </div>
                        <div class="question-sidebar">
                            <span class="level-tag principal">Principal</span>
                            <span class="level-tag lead">Lead</span>
                        </div>
                    </div>
                </div>
                <div class="question-score">
                    <button class="score-btn concern" data-category="leadership" data-value="1" onclick="selectScore(this)">Concern</button>
                    <button class="score-btn ok" data-category="leadership" data-value="3" onclick="selectScore(this)">OK</button>
                    <button class="score-btn strong" data-category="leadership" data-value="5" onclick="selectScore(this)">Strong</button>
                </div>
            </div>

            <div class="question-card">
                <div class="question-header">
                    <span class="question-id">Q4</span>
                    <span class="question-text">"Tell me about a time a client disagreed with your technical findings."</span>
                </div>
                <div class="question-body">
                    <div class="question-content">
                        <div class="listen-for">
                            <h4>Good Answers Include</h4>
                            <ul>
                                <li>Stood by their analysis with evidence</li>
                                <li>Offered to explain methodology</li>
                                <li>Professional under pressure</li>
                                <li>Open to peer review</li>
                            </ul>
                        </div>
                    </div>
                    <div class="question-right">
                        <div class="flags">
                            <div class="flag-box green">
                                <h5>Green</h5>
                                <p>Evidence-backed confidence, open to scrutiny</p>
                            </div>
                            <div class="flag-box red">
                                <h5>Red</h5>
                                <p>Caved to pressure, defensive, refused to discuss</p>
                            </div>
                        </div>
                        <div class="question-sidebar">
                            <span class="level-tag principal">Principal</span>
                            <span class="level-tag lead">Lead</span>
                        </div>
                    </div>
                </div>
                <div class="question-score">
                    <button class="score-btn concern" data-category="leadership" data-value="1" onclick="selectScore(this)">Concern</button>
                    <button class="score-btn ok" data-category="leadership" data-value="3" onclick="selectScore(this)">OK</button>
                    <button class="score-btn strong" data-category="leadership" data-value="5" onclick="selectScore(this)">Strong</button>
                </div>
            </div>

            <div class="question-card">
                <div class="question-header">
                    <span class="question-id">Q5</span>
                    <span class="question-text">"Have you ever found an error in work that had already been submitted? What did you do?"</span>
                </div>
                <div class="question-body">
                    <div class="question-content">
                        <div class="listen-for">
                            <h4>Good Answers Include</h4>
                            <ul>
                                <li>Told the client/stakeholder immediately</li>
                                <li>Took responsibility (not blamed juniors)</li>
                                <li>Fixed it and prevented recurrence</li>
                            </ul>
                        </div>
                    </div>
                    <div class="question-right">
                        <div class="flags">
                            <div class="flag-box green">
                                <h5>Green</h5>
                                <p>Transparency, accountability, process improvement</p>
                            </div>
                            <div class="flag-box red">
                                <h5>Red</h5>
                                <p>Hid it, blamed others, minimized</p>
                            </div>
                        </div>
                        <div class="question-sidebar">
                            <span class="level-tag principal">Principal</span>
                            <span class="level-tag lead">Lead</span>
                            <span class="level-tag senior">Senior</span>
                        </div>
                    </div>
                </div>
                <div class="question-score">
                    <button class="score-btn concern" data-category="leadership" data-value="1" onclick="selectScore(this)">Concern</button>
                    <button class="score-btn ok" data-category="leadership" data-value="3" onclick="selectScore(this)">OK</button>
                    <button class="score-btn strong" data-category="leadership" data-value="5" onclick="selectScore(this)">Strong</button>
                </div>
            </div>
        </section>

        <!-- Part 3: Technical -->
        <section class="section">
            <div class="section-header">
                <div class="section-number">3</div>
                <h2 class="section-title">Technical Foundations</h2>
            </div>

            <div class="question-card">
                <div class="question-header">
                    <span class="question-id">Q6</span>
                    <span class="question-text">"What's the difference between Grid-Following and Grid-Forming inverters?"</span>
                </div>
                <div class="question-body">
                    <div class="question-content">
                        <div class="listen-for">
                            <h4>They Should Mention</h4>
                            <ul>
                                <li><strong>GFL:</strong> follows grid voltage/frequency (needs strong grid)</li>
                                <li><strong>GFM:</strong> creates own reference (works in weak grids)</li>
                            </ul>
                        </div>
                    </div>
                    <div class="question-right">
                        <div class="flags">
                            <div class="flag-box green">
                                <h5>Bonus</h5>
                                <p>Weak grid challenges, system strength experience</p>
                            </div>
                            <div class="flag-box red">
                                <h5>Red</h5>
                                <p>Never heard of GFM/GFL distinction</p>
                            </div>
                        </div>
                        <div class="question-sidebar">
                            <span class="level-tag principal">Principal</span>
                            <span class="level-tag lead">Lead</span>
                            <span class="level-tag senior">Senior</span>
                        </div>
                    </div>
                </div>
                <div class="question-score">
                    <button class="score-btn concern" data-category="technical" data-value="1" onclick="selectScore(this)">Concern</button>
                    <button class="score-btn ok" data-category="technical" data-value="3" onclick="selectScore(this)">OK</button>
                    <button class="score-btn strong" data-category="technical" data-value="5" onclick="selectScore(this)">Strong</button>
                </div>
            </div>

            <div class="question-card">
                <div class="question-header">
                    <span class="question-id">Q7</span>
                    <span class="question-text">"What does SCR mean and why does it matter?"</span>
                </div>
                <div class="question-body">
                    <div class="question-content">
                        <div class="listen-for">
                            <h4>They Should Mention</h4>
                            <ul>
                                <li>Short Circuit Ratio</li>
                                <li>Measures grid strength at connection point</li>
                                <li>Low SCR = weak grid = instability risk</li>
                            </ul>
                        </div>
                    </div>
                    <div class="question-right">
                        <div class="flags">
                            <div class="flag-box green">
                                <h5>Green</h5>
                                <p>General understanding of concept and importance</p>
                            </div>
                            <div class="flag-box red">
                                <h5>Red</h5>
                                <p>Never heard of it (fundamental concept)</p>
                            </div>
                        </div>
                        <div class="question-sidebar">
                            <span class="level-tag principal">Principal</span>
                            <span class="level-tag lead">Lead</span>
                            <span class="level-tag senior">Senior</span>
                        </div>
                    </div>
                </div>
                <div class="question-score">
                    <button class="score-btn concern" data-category="technical" data-value="1" onclick="selectScore(this)">Concern</button>
                    <button class="score-btn ok" data-category="technical" data-value="3" onclick="selectScore(this)">OK</button>
                    <button class="score-btn strong" data-category="technical" data-value="5" onclick="selectScore(this)">Strong</button>
                </div>
            </div>

            <div class="question-card">
                <div class="question-header">
                    <span class="question-id">Q8</span>
                    <span class="question-text">"Can you explain what an R1 study involves?"</span>
                </div>
                <div class="question-body">
                    <div class="question-content">
                        <div class="listen-for">
                            <h4>They Should Mention</h4>
                            <ul>
                                <li>Model-based study (simulation)</li>
                                <li>Demonstrates grid code compliance</li>
                                <li>Done before commissioning</li>
                            </ul>
                        </div>
                    </div>
                    <div class="question-right">
                        <div class="flags">
                            <div class="flag-box green">
                                <h5>Bonus</h5>
                                <p>PSCAD/PSS/E, NER clauses, GPS, DMNT</p>
                            </div>
                            <div class="flag-box red">
                                <h5>Red</h5>
                                <p>Confuses R1 with R2, no connection study experience</p>
                            </div>
                        </div>
                        <div class="question-sidebar">
                            <span class="level-tag principal">Principal</span>
                            <span class="level-tag lead">Lead</span>
                            <span class="level-tag senior">Senior</span>
                        </div>
                    </div>
                </div>
                <div class="question-score">
                    <button class="score-btn concern" data-category="technical" data-value="1" onclick="selectScore(this)">Concern</button>
                    <button class="score-btn ok" data-category="technical" data-value="3" onclick="selectScore(this)">OK</button>
                    <button class="score-btn strong" data-category="technical" data-value="5" onclick="selectScore(this)">Strong</button>
                </div>
            </div>

            <div class="question-card">
                <div class="question-header">
                    <span class="question-id">Q9</span>
                    <span class="question-text">"What's a PPC and what does it do?"</span>
                </div>
                <div class="question-body">
                    <div class="question-content">
                        <div class="listen-for">
                            <h4>They Should Mention</h4>
                            <ul>
                                <li>Plant Primary Controller / Power Plant Controller</li>
                                <li>Coordinates all inverters in a plant</li>
                                <li>Manages output at connection point</li>
                            </ul>
                        </div>
                    </div>
                    <div class="question-right">
                        <div class="flags">
                            <div class="flag-box green">
                                <h5>Bonus</h5>
                                <p>P/Q control, voltage regulation, tuning experience</p>
                            </div>
                            <div class="flag-box red">
                                <h5>Red</h5>
                                <p>Doesn't know what PPC stands for</p>
                            </div>
                        </div>
                        <div class="question-sidebar">
                            <span class="level-tag principal">Principal</span>
                            <span class="level-tag lead">Lead</span>
                            <span class="level-tag senior">Senior</span>
                        </div>
                    </div>
                </div>
                <div class="question-score">
                    <button class="score-btn concern" data-category="technical" data-value="1" onclick="selectScore(this)">Concern</button>
                    <button class="score-btn ok" data-category="technical" data-value="3" onclick="selectScore(this)">OK</button>
                    <button class="score-btn strong" data-category="technical" data-value="5" onclick="selectScore(this)">Strong</button>
                </div>
            </div>
        </section>

        <!-- Quick Reference -->
        <section class="section">
            <div class="section-header">
                <div class="section-number">4</div>
                <h2 class="section-title">Quick Reference</h2>
            </div>

            <table class="reference-table">
                <thead>
                    <tr>
                        <th>Trait</th>
                        <th>Green Flags</th>
                        <th>Red Flags</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="trait">Confidence</td>
                        <td>Clear explanations, owns their work, admits gaps honestly</td>
                        <td>Vague, defensive, over-claims expertise</td>
                    </tr>
                    <tr>
                        <td class="trait">Leadership</td>
                        <td>Develops others, takes accountability, composure with clients</td>
                        <td>Micromanages, blames team, avoids conflict</td>
                    </tr>
                    <tr>
                        <td class="trait">Technical</td>
                        <td>Knows fundamentals, mentions specific tools/projects</td>
                        <td>Can't explain basics, never heard of key terms</td>
                    </tr>
                </tbody>
            </table>

            <div class="pass-criteria" style="margin-top: 30px;">
                <strong>Pass to technical interview if:</strong> 32/45 (70%+) with no major red flags
            </div>
        </section>
    </main>

    <footer class="footer">
        <p>Recruiter Pre-Screening Guide | Grid Connection Engineer Candidates</p>
        <p class="tagline">Ingenuity. Imagination. Insight.</p>
        <p style="margin-top: 16px; font-size: 11px; opacity: 0.5;">Tool developed by CM</p>
    </footer>
    </div>

    <script src="js/supabase-client.js"></script>
    <script src="js/role-requirements.js"></script>
    <script>
        // Resume Analyzer
        let resumeFile = null;

        function toggleAnalyzer() {
            const body = document.getElementById('analyzerBody');
            const toggle = document.getElementById('analyzerToggle');
            body.classList.toggle('open');
            toggle.textContent = body.classList.contains('open') ? 'Close' : 'Upload Resume';
        }

        // Drag and drop
        document.addEventListener('DOMContentLoaded', () => {
            const upload = document.getElementById('analyzerUpload');
            if (upload) {
                upload.addEventListener('dragover', (e) => { e.preventDefault(); upload.classList.add('dragover'); });
                upload.addEventListener('dragleave', () => upload.classList.remove('dragover'));
                upload.addEventListener('drop', (e) => {
                    e.preventDefault();
                    upload.classList.remove('dragover');
                    if (e.dataTransfer.files.length) handleResumeFile(e.dataTransfer.files[0]);
                });
            }
        });

        document.addEventListener('change', (e) => {
            if (e.target.id === 'resumeFileInput' && e.target.files.length) {
                handleResumeFile(e.target.files[0]);
            }
        });

        async function handleResumeFile(file) {
            const validTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'text/plain'];
            if (!validTypes.includes(file.type)) {
                alert('Please upload a PDF, DOC, DOCX, or TXT file.');
                return;
            }
            resumeFile = file;
            document.getElementById('selectedFileName').textContent = file.name;
            document.getElementById('fileSelected').classList.add('visible');
            document.getElementById('analyzeResumeBtn').disabled = false;

            // Extract name and email
            try {
                const text = await readResumeText(file);
                const emailMatch = text.match(/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/);
                if (emailMatch) document.getElementById('resumeCandidateEmail').value = emailMatch[0];

                const lines = text.split('\n').map(l => l.trim()).filter(l => l.length > 0);
                if (lines.length > 0) {
                    let nameLine = lines[0].replace(/^(mr|mrs|ms|dr|prof)\.?\s*/i, '').replace(/\s+/g, ' ').trim();
                    if (nameLine.split(' ').length <= 4 && /^[a-zA-Z\s\-']+$/.test(nameLine)) {
                        document.getElementById('resumeCandidateName').value = nameLine;
                    }
                }
            } catch (err) { console.log('Could not extract info:', err); }
        }

        function readResumeText(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = reject;
                if (file.type === 'application/pdf') reader.readAsDataURL(file);
                else reader.readAsText(file);
            });
        }

        async function runAnalysis() {
            const name = document.getElementById('resumeCandidateName').value.trim();
            const email = document.getElementById('resumeCandidateEmail').value.trim();
            const position = document.getElementById('resumeTargetPosition').value;

            if (!resumeFile) { alert('Please select a resume file.'); return; }

            // Show loading
            document.getElementById('analyzingIndicator').classList.add('visible');
            document.getElementById('aiResult').classList.remove('visible');
            document.getElementById('analyzeResumeBtn').disabled = true;

            // Clear previous highlights
            clearSkillHighlights();

            try {
                const fileContent = await readResumeText(resumeFile);

                const response = await fetch('/.netlify/functions/analyze-resume', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        resumeText: fileContent,
                        candidateName: name,
                        targetPosition: position,
                        roleRequirements: window.roleRequirements
                    })
                });

                if (!response.ok) throw new Error('Analysis failed');

                const analysis = await response.json();

                // Auto-fill name and email from AI extraction if fields are empty
                const nameField = document.getElementById('resumeCandidateName');
                const emailField = document.getElementById('resumeCandidateEmail');
                if (analysis.extractedName && !nameField.value) {
                    nameField.value = analysis.extractedName;
                }
                if (analysis.extractedEmail && !emailField.value) {
                    emailField.value = analysis.extractedEmail;
                }

                // Use the best available name and email (field value takes priority)
                const finalName = nameField.value.trim() || analysis.extractedName || name;
                const finalEmail = emailField.value.trim() || analysis.extractedEmail || email;

                // Sync name back to field if AI provided it
                if (finalName && !nameField.value) nameField.value = finalName;

                // Save to database
                try {
                    await saveResumeAnalysis({
                        candidate_name: finalName,
                        candidate_email: finalEmail,
                        target_position: position,
                        groq_analysis: analysis,
                        overall_score: analysis.overallScore,
                        recommendation: analysis.recommendation
                    });
                    await logActivity('analyze_resume', { candidate: finalName, position, score: analysis.overallScore });
                } catch (dbErr) { console.log('DB save error (non-blocking):', dbErr); }

                // Display results
                displayInlineResults(analysis);

                // Highlight role cards
                highlightSkills(analysis);

                // Auto-fill candidate name in scoring bar
                const scoringName = document.getElementById('candidateName');
                if (scoringName && !scoringName.value) scoringName.value = finalName;

                // Check if candidate was previously interviewed
                await checkInterviewHistory(finalName);

                // Refresh the recent analyses list
                loadRecentAnalyses();

            } catch (err) {
                console.error('Analysis error:', err);
                alert('Error analyzing resume. Please try again.');
            } finally {
                document.getElementById('analyzingIndicator').classList.remove('visible');
                document.getElementById('analyzeResumeBtn').disabled = false;
            }
        }

        function displayInlineResults(analysis) {
            const result = document.getElementById('aiResult');
            document.getElementById('aiScoreBadges').innerHTML =
                `<span class="score-badge overall">${analysis.overallScore}% Match</span>` +
                `<span class="score-badge level">${analysis.recommendedLevel || 'N/A'}</span>`;

            document.getElementById('aiSummaryText').textContent = analysis.summary || '';

            document.getElementById('aiStrengths').innerHTML = (analysis.keyStrengths || [])
                .map(s => `<li>${s}</li>`).join('') || '<li>None identified</li>';

            document.getElementById('aiGaps').innerHTML = (analysis.gaps || [])
                .map(g => `<li>${g}</li>`).join('') || '<li>None identified</li>';

            result.classList.add('visible');
        }

        function highlightSkills(analysis) {
            const roleMatches = analysis.roleMatches || {};
            const roles = ['senior', 'lead', 'principal'];

            roles.forEach(role => {
                const data = roleMatches[role];
                if (!data || !data.skills) return;

                data.skills.forEach((match, i) => {
                    const el = document.querySelector(`[data-skill="${role}-${i}"]`);
                    if (!el) return;

                    if (match === 'strong') {
                        el.classList.add('skill-strong');
                    } else if (match === 'partial') {
                        el.classList.add('skill-partial');
                    } else {
                        el.classList.add('skill-none-checked');
                    }
                });
            });

            // Scroll to role cards to show highlights
            document.querySelector('.role-progression').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function clearSkillHighlights() {
            document.querySelectorAll('[data-skill]').forEach(el => {
                el.classList.remove('skill-strong', 'skill-partial', 'skill-none-checked');
            });
        }

        // Initialize and check authentication
        let authHandled = false;

        function unlockApp(session) {
            if (authHandled) return;
            authHandled = true;
            const overlay = document.getElementById('passwordOverlay');
            const content = document.getElementById('protectedContent');
            overlay.style.display = 'none';
            content.classList.add('unlocked');
            document.getElementById('userEmail').textContent = session.user.email;
            document.getElementById('userPanel').classList.add('visible');

            if (session.user.email === 'chris.marinelli@vysusgroup.com') {
                document.getElementById('adminGear').style.display = 'inline';
            }

            // Non-blocking background tasks
            updateLastLogin(session.user.id).catch(() => {});
            logActivity('view_screening_guide', { page: 'index.html' }).catch(() => {});
            loadRecentAnalyses().catch(() => {});
        }

        document.addEventListener('DOMContentLoaded', async () => {
            initSupabase();

            const overlay = document.getElementById('passwordOverlay');
            const content = document.getElementById('protectedContent');
            const authTitle = document.getElementById('authTitle');
            const authSubtitle = document.getElementById('authSubtitle');
            const loginPrompt = document.getElementById('loginPrompt');

            // Check for dev session first (localhost testing)
            const devSession = localStorage.getItem('vysus_dev_session');
            if (devSession) {
                const dev = JSON.parse(devSession);
                overlay.style.display = 'none';
                content.classList.add('unlocked');
                document.getElementById('userEmail').textContent = dev.email + ' (DEV)';
                document.getElementById('userPanel').classList.add('visible');
                document.getElementById('adminGear').style.display = 'inline';
                authHandled = true;
                return;
            }

            // Listen for auth state changes (handles token refresh, magic link callback)
            sb.auth.onAuthStateChange((event, session) => {
                if (session && (event === 'SIGNED_IN' || event === 'TOKEN_REFRESHED' || event === 'INITIAL_SESSION')) {
                    unlockApp(session);
                }
            });

            // Also do a direct session check as fallback
            try {
                const { session } = await getSession();
                if (session) {
                    unlockApp(session);
                } else {
                    // Wait briefly for onAuthStateChange to fire (magic link hash processing)
                    setTimeout(() => {
                        if (!authHandled) {
                            authTitle.textContent = 'Authentication Required';
                            authSubtitle.textContent = 'Please sign in to access this document.';
                            loginPrompt.style.display = 'block';
                        }
                    }, 1500);
                }
            } catch (err) {
                console.error('Auth check error:', err);
                if (!authHandled) {
                    authTitle.textContent = 'Authentication Required';
                    authSubtitle.textContent = 'Please sign in to access this document.';
                    loginPrompt.style.display = 'block';
                }
            }
        });

        // Sign out handler
        async function handleSignOut() {
            // Clear dev session if exists
            localStorage.removeItem('vysus_dev_session');
            await logActivity('sign_out', {});
            await signOut();
        }

        // Add score dots to all question headers
        document.querySelectorAll('.question-header').forEach((header, i) => {
            const dots = document.createElement('div');
            dots.className = 'score-dots';
            dots.id = 'dots-' + i;
            dots.innerHTML = '<span class="score-dot"></span><span class="score-dot"></span><span class="score-dot"></span><span class="score-dot"></span><span class="score-dot"></span>';
            header.appendChild(dots);
        });

        // Scoring functionality
        function selectScore(btn) {
            // Deselect siblings
            const parent = btn.parentElement;
            parent.querySelectorAll('.score-btn').forEach(b => b.classList.remove('selected'));
            // Select this one
            btn.classList.add('selected');
            // Update dots on question header
            const card = btn.closest('.question-card');
            if (card) {
                const dots = card.querySelector('.score-dots');
                if (dots) dots.setAttribute('data-score', btn.dataset.value);
            }
            // Update totals
            updateScores();
        }

        function updateScores() {
            const selected = document.querySelectorAll('.score-btn.selected');
            let confidence = 0, leadership = 0, technical = 0;
            let questionsScored = selected.length;

            selected.forEach(btn => {
                const val = parseInt(btn.dataset.value);
                const cat = btn.dataset.category;
                if (cat === 'confidence') confidence += val;
                else if (cat === 'leadership') leadership += val;
                else if (cat === 'technical') technical += val;
            });

            const total = confidence + leadership + technical;
            const maxScore = 45;
            const percent = Math.round((total / maxScore) * 100);

            document.getElementById('confidenceTotal').textContent = confidence + '/10';
            document.getElementById('leadershipTotal').textContent = leadership + '/15';
            document.getElementById('technicalTotal').textContent = technical + '/20';
            document.getElementById('grandTotal').textContent = total + '/' + maxScore;

            // Update pass/fail indicator
            const indicator = document.getElementById('passFail');
            if (questionsScored >= 5) {
                if (percent >= 70) {
                    indicator.className = 'pass-fail-indicator pass';
                    indicator.textContent = 'PASS (' + percent + '%)';
                } else {
                    indicator.className = 'pass-fail-indicator fail';
                    indicator.textContent = 'FAIL (' + percent + '%)';
                }
            } else {
                indicator.className = 'pass-fail-indicator pending';
                indicator.textContent = questionsScored + '/9 scored';
            }

            // Show bar when scoring begins
            if (questionsScored > 0) {
                document.getElementById('scoringBar').classList.add('visible');
            }

            // Generate summary when enough questions scored
            if (questionsScored >= 5) {
                generateSummary(confidence, leadership, technical, questionsScored);
            }
        }

        function generateSummary(confidence, leadership, technical, questionsScored) {
            const panel = document.getElementById('summaryPanel');
            const strengthsList = document.getElementById('strengthsList');
            const concernsList = document.getElementById('concernsList');
            const recLevel = document.getElementById('recLevel');
            const recReasoning = document.getElementById('recReasoning');
            const recCaution = document.getElementById('recCaution');

            // Question labels mapped to categories and what they indicate
            const questionMap = [
                { id: 0, label: 'Project ownership & complexity', category: 'confidence', seniorReq: true, leadReq: true, principalReq: true },
                { id: 1, label: 'Software tool proficiency', category: 'confidence', seniorReq: true, leadReq: true, principalReq: false },
                { id: 2, label: 'Team mentoring & management', category: 'leadership', seniorReq: false, leadReq: true, principalReq: true },
                { id: 3, label: 'Client relationship & composure', category: 'leadership', seniorReq: false, leadReq: true, principalReq: true },
                { id: 4, label: 'Accountability & error handling', category: 'leadership', seniorReq: true, leadReq: true, principalReq: true },
                { id: 5, label: 'GFL/GFM inverter knowledge', category: 'technical', seniorReq: true, leadReq: true, principalReq: true },
                { id: 6, label: 'System strength (SCR) understanding', category: 'technical', seniorReq: true, leadReq: true, principalReq: true },
                { id: 7, label: 'R1 study process knowledge', category: 'technical', seniorReq: true, leadReq: true, principalReq: true },
                { id: 8, label: 'PPC functionality understanding', category: 'technical', seniorReq: true, leadReq: true, principalReq: true }
            ];

            // Get individual question scores
            const scoreCards = document.querySelectorAll('.question-score');
            const scores = [];
            scoreCards.forEach((card, i) => {
                const sel = card.querySelector('.score-btn.selected');
                scores.push(sel ? parseInt(sel.dataset.value) : null);
            });

            // Build strengths and concerns
            const strengths = [];
            const concerns = [];

            scores.forEach((score, i) => {
                if (score === null) return;
                if (score === 5) strengths.push(questionMap[i].label);
                if (score === 1) concerns.push(questionMap[i].label);
            });

            // Category-level assessments
            const confPercent = (confidence / 10) * 100;
            const leadPercent = (leadership / 15) * 100;
            const techPercent = (technical / 20) * 100;

            if (confPercent >= 80 && strengths.indexOf('Project ownership & complexity') === -1) {
                strengths.unshift('Strong confidence & communication');
            }
            if (techPercent >= 80 && strengths.length < 4) {
                strengths.push('Solid technical foundations');
            }
            if (leadPercent >= 80 && strengths.length < 4) {
                strengths.push('Clear leadership capability');
            }

            if (confPercent <= 40) concerns.push('Weak confidence signals');
            if (techPercent <= 40) concerns.push('Technical gaps - needs development');
            if (leadPercent <= 40 && questionsScored >= 7) concerns.push('Limited leadership evidence');

            // Determine recommended level
            let level = '';
            let reasoning = '';
            let caution = '';

            const hasConcernInTech = scores[5] === 1 || scores[6] === 1 || scores[7] === 1 || scores[8] === 1;
            const hasConcernInLead = scores[2] === 1 || scores[3] === 1;
            const allTechStrong = scores.slice(5, 9).every(s => s === 5 || s === null);
            const allLeadStrong = scores.slice(2, 5).every(s => s === 5 || s === null);

            if (techPercent >= 75 && leadPercent >= 80 && confPercent >= 80 && !hasConcernInTech && !hasConcernInLead) {
                level = 'Principal Engineer';
                reasoning = 'Strong across all dimensions. Demonstrates technical depth, leadership maturity, and confident communication needed for strategic-level delivery.';
                if (scores[2] === 3) caution = 'Probe mentoring depth further in technical interview.';
            } else if (techPercent >= 60 && leadPercent >= 60 && confPercent >= 60 && !hasConcernInTech) {
                level = 'Lead Engineer';
                reasoning = 'Good technical base with demonstrated leadership and client-facing ability. Suitable for project ownership and team coordination.';
                if (hasConcernInLead) caution = 'Leadership area has a concern flag - verify mentoring/client skills in next round.';
            } else if (techPercent >= 50 && confPercent >= 50) {
                level = 'Senior Engineer';
                reasoning = 'Solid technical delivery capability. Focus on independent study execution and tool proficiency rather than leadership scope.';
                if (hasConcernInTech) caution = 'Technical concern flagged - confirm core simulation competence in technical interview.';
                if (leadPercent >= 60) reasoning += ' Shows leadership potential for future development into Lead role.';
            } else {
                level = 'Below Senior threshold';
                reasoning = 'Scores indicate gaps in core areas. May need more experience before Senior-level responsibilities.';
                caution = 'Consider whether a more junior role or additional screening is appropriate.';
            }

            // Render
            strengthsList.innerHTML = strengths.length > 0
                ? strengths.map(s => '<li>' + s + '</li>').join('')
                : '<li style="color: var(--vysus-bergen-rain);">No strong signals yet</li>';

            concernsList.innerHTML = concerns.length > 0
                ? concerns.map(c => '<li>' + c + '</li>').join('')
                : '<li style="color: var(--vysus-stockholm-neon);">No concerns flagged</li>';

            recLevel.textContent = level;
            recReasoning.textContent = reasoning;
            recCaution.textContent = caution;

            panel.classList.add('visible');

            // Auto-save to database
            autoSaveScreening();
        }

        let autoSaveTimeout = null;
        function autoSaveScreening() {
            // Debounce to avoid rapid saves when clicking quickly
            if (autoSaveTimeout) clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(async () => {
                const statusEl = document.getElementById('autoSaveStatus');
                statusEl.textContent = 'Saving...';
                try {
                    const name = document.getElementById('candidateName').value || 'Unnamed Candidate';
                    const scoreCards = document.querySelectorAll('.question-score');
                    const questionScores = [];
                    const questions = ['Q1: Project complexity', 'Q2: Software tools', 'Q3: Team management', 'Q4: Client disagreement', 'Q5: Error handling', 'Q6: GFL vs GFM', 'Q7: SCR', 'Q8: R1 studies', 'Q9: PPC'];
                    scoreCards.forEach((card, i) => {
                        const sel = card.querySelector('.score-btn.selected');
                        questionScores.push({ question: questions[i], score: sel ? parseInt(sel.dataset.value) : null, rating: sel ? sel.textContent : 'Not scored' });
                    });

                    const strengthItems = Array.from(document.querySelectorAll('#strengthsList li')).map(li => li.textContent);
                    const concernItems = Array.from(document.querySelectorAll('#concernsList li')).map(li => li.textContent);
                    const confScore = parseInt(document.getElementById('confidenceTotal').textContent) || 0;
                    const leadScore = parseInt(document.getElementById('leadershipTotal').textContent) || 0;
                    const techScore = parseInt(document.getElementById('technicalTotal').textContent) || 0;
                    const totalScore = parseInt(document.getElementById('grandTotal').textContent) || 0;
                    const percentage = Math.round((totalScore / 45) * 100);
                    const passFail = document.getElementById('passFail').textContent;
                    const recLevelText = document.getElementById('recLevel').textContent;
                    const recReasoningText = document.getElementById('recReasoning').textContent;
                    const recCautionText = document.getElementById('recCaution').textContent;

                    const interviewCheck = await checkInterviewedCandidate(name);
                    const wasInterviewed = interviewCheck.matches && interviewCheck.matches.length > 0;

                    await saveScreeningResult({
                        candidate_name: name,
                        confidence_score: confScore,
                        leadership_score: leadScore,
                        technical_score: techScore,
                        total_score: totalScore,
                        percentage: percentage,
                        pass_fail: passFail,
                        question_scores: questionScores,
                        strengths: strengthItems,
                        concerns: concernItems,
                        recommended_level: recLevelText !== '-' ? recLevelText : null,
                        reasoning: recReasoningText || null,
                        caution: recCautionText || null,
                        previously_interviewed: wasInterviewed,
                        interview_history: wasInterviewed ? interviewCheck.matches : null
                    });
                    await logActivity('auto_save_screening', { candidate: name, result: passFail, level: recLevelText });
                    statusEl.textContent = 'Saved';
                    setTimeout(() => { statusEl.textContent = ''; }, 3000);
                } catch (err) {
                    console.log('Auto-save error:', err);
                    statusEl.textContent = '';
                }
            }, 2000);
        }

        function getResultsText() {
            const name = document.getElementById('candidateName').value || 'Unnamed Candidate';
            const date = new Date().toLocaleDateString();
            const confidence = document.getElementById('confidenceTotal').textContent;
            const leadership = document.getElementById('leadershipTotal').textContent;
            const technical = document.getElementById('technicalTotal').textContent;
            const total = document.getElementById('grandTotal').textContent;
            const passFail = document.getElementById('passFail').textContent;

            // Get per-question details
            const questions = ['Q1: Project complexity', 'Q2: Software tools', 'Q3: Team management', 'Q4: Client disagreement', 'Q5: Error handling', 'Q6: GFL vs GFM', 'Q7: SCR', 'Q8: R1 studies', 'Q9: PPC'];
            let details = '';
            document.querySelectorAll('.question-score').forEach((score, i) => {
                const sel = score.querySelector('.score-btn.selected');
                const rating = sel ? sel.textContent : 'Not scored';
                details += `  ${questions[i]}: ${rating}\n`;
            });

            // Get summary info
            const recLevel = document.getElementById('recLevel').textContent;
            const recReasoning = document.getElementById('recReasoning').textContent;
            const recCaution = document.getElementById('recCaution').textContent;
            const strengthItems = Array.from(document.querySelectorAll('#strengthsList li')).map(li => li.textContent);
            const concernItems = Array.from(document.querySelectorAll('#concernsList li')).map(li => li.textContent);

            let summary = '';
            if (recLevel && recLevel !== '-') {
                summary = `\nASSESSMENT SUMMARY:\n` +
                    `Recommended Level: ${recLevel}\n` +
                    `${recReasoning}\n` +
                    (recCaution ? `Note: ${recCaution}\n` : '') +
                    `\nStrengths: ${strengthItems.join(', ')}\n` +
                    `Concerns: ${concernItems.join(', ')}\n`;
            }

            return `CANDIDATE SCREENING RESULTS\n` +
                `================================\n` +
                `Candidate: ${name}\n` +
                `Date: ${date}\n` +
                `Result: ${passFail}\n\n` +
                `SCORES:\n` +
                `- Confidence & Communication: ${confidence}\n` +
                `- Leadership & Management: ${leadership}\n` +
                `- Technical Foundations: ${technical}\n` +
                `- TOTAL: ${total}\n\n` +
                `DETAIL:\n${details}\n` +
                summary +
                `\nPass threshold: 70%+ with no major red flags\n` +
                `\n---\nVysus Group | Grid Connection Engineer Screening`;
        }

        function emailResults() {
            const name = document.getElementById('candidateName').value || 'Candidate';
            const results = getResultsText();
            const subject = encodeURIComponent(`Screening Result: ${name} - Grid Connection Engineer`);
            const body = encodeURIComponent(results);
            window.location.href = `mailto:?subject=${subject}&body=${body}`;
        }

        // ===== USER PANEL (own data only - RLS enforced) =====
        function toggleUserPanel() {
            const body = document.getElementById('userBody');
            const toggle = document.getElementById('userToggle');
            body.classList.toggle('open');
            toggle.textContent = body.classList.contains('open') ? 'Close' : 'View';
            if (body.classList.contains('open')) loadMyScreenings();
        }

        function showUserTab(tab, btn) {
            document.querySelectorAll('#userPanel .admin-tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            if (tab === 'myScreenings') loadMyScreenings();
            else if (tab === 'myAnalyses') loadMyAnalyses();
        }

        async function loadMyScreenings() {
            const content = document.getElementById('userContent');
            content.innerHTML = '<p style="color: rgba(255,255,255,0.5); font-size: 13px;">Loading...</p>';
            try {
                // RLS ensures only own results returned
                const { data, error } = await sb.from('screening_results').select('*').order('created_at', { ascending: false }).limit(20);
                if (error) throw error;
                if (!data || data.length === 0) {
                    content.innerHTML = '<p style="color: rgba(255,255,255,0.5); font-size: 13px;">No screening results yet. Score a candidate to see results here.</p>';
                    return;
                }
                let html = '<table class="admin-table"><thead><tr><th>Date</th><th>Candidate</th><th>Score</th><th>Result</th><th>Level</th></tr></thead><tbody>';
                data.forEach(row => {
                    const time = new Date(row.created_at).toLocaleString('en-AU', { day: '2-digit', month: 'short', year: 'numeric' });
                    html += `<tr><td>${time}</td><td>${row.candidate_name}</td><td>${row.total_score}/${row.max_score} (${row.percentage}%)</td><td>${row.pass_fail || '-'}</td><td>${row.recommended_level || '-'}</td></tr>`;
                });
                html += '</tbody></table>';
                content.innerHTML = html;
            } catch (err) {
                content.innerHTML = '<p style="color: #F92D63; font-size: 13px;">Error loading results.</p>';
            }
        }

        async function loadMyAnalyses() {
            const content = document.getElementById('userContent');
            content.innerHTML = '<p style="color: rgba(255,255,255,0.5); font-size: 13px;">Loading...</p>';
            try {
                // RLS ensures only own analyses returned
                const { data, error } = await getResumeAnalyses(20);
                if (error) throw error;
                if (!data || data.length === 0) {
                    content.innerHTML = '<p style="color: rgba(255,255,255,0.5); font-size: 13px;">No resume analyses yet. Upload a resume to see results here.</p>';
                    return;
                }
                let html = '<table class="admin-table"><thead><tr><th>Date</th><th>Candidate</th><th>Position</th><th>Score</th><th>Recommendation</th></tr></thead><tbody>';
                data.forEach(row => {
                    const time = new Date(row.created_at).toLocaleString('en-AU', { day: '2-digit', month: 'short', year: 'numeric' });
                    html += `<tr><td>${time}</td><td>${row.candidate_name}</td><td>${row.target_position || '-'}</td><td>${row.overall_score || '-'}%</td><td>${row.recommendation || '-'}</td></tr>`;
                });
                html += '</tbody></table>';
                content.innerHTML = html;
            } catch (err) {
                content.innerHTML = '<p style="color: #F92D63; font-size: 13px;">Error loading analyses.</p>';
            }
        }

        // Recently Analyzed Candidates list
        function toggleRecentAnalyses() {
            const body = document.getElementById('recentAnalysesBody');
            const toggle = document.getElementById('recentAnalysesToggle');
            const isOpen = body.style.display !== 'none';
            body.style.display = isOpen ? 'none' : 'block';
            toggle.textContent = isOpen ? 'View' : 'Close';
        }

        async function loadRecentAnalyses() {
            const section = document.getElementById('recentAnalysesSection');
            const tbody = document.getElementById('recentAnalysesList');
            try {
                const { data, error } = await getResumeAnalyses(20);
                if (error) throw error;
                if (!data || data.length === 0) {
                    section.style.display = 'none';
                    return;
                }
                section.style.display = 'block';
                tbody.innerHTML = data.map(row => {
                    const date = new Date(row.created_at).toLocaleDateString('en-AU', { day: '2-digit', month: 'short', year: 'numeric' });
                    return `<tr style="border-bottom: 1px solid var(--vysus-bergen-rain);">
                        <td style="padding: 10px 16px; font-size: 13px; font-weight: 500; color: var(--vysus-malmo-green);">${row.candidate_name}</td>
                        <td style="padding: 10px 16px; font-size: 13px; color: var(--vysus-scandinavia-rock);">${row.candidate_email || '-'}</td>
                        <td style="padding: 10px 16px; font-size: 13px; color: var(--vysus-scandinavia-rock);">${row.target_position || '-'}</td>
                        <td style="padding: 10px 16px; font-size: 13px; color: var(--vysus-scandinavia-rock);">${row.overall_score != null ? row.overall_score + '%' : '-'}</td>
                        <td style="padding: 10px 16px; font-size: 13px; color: var(--vysus-scandinavia-rock);">${date}</td>
                    </tr>`;
                }).join('');
            } catch (err) {
                console.log('Error loading recent analyses:', err);
                section.style.display = 'none';
            }
        }

        // Check if candidate was previously interviewed
        async function checkInterviewHistory(candidateName) {
            const resultDiv = document.getElementById('interviewCheckResult');
            if (!candidateName || candidateName.trim().length < 2) {
                resultDiv.style.display = 'none';
                return;
            }

            try {
                const { matches, error } = await checkInterviewedCandidate(candidateName);
                if (error) { console.log('Interview check error:', error); return; }

                if (matches.length === 0) {
                    resultDiv.style.display = 'block';
                    resultDiv.style.background = 'rgba(0, 227, 169, 0.1)';
                    resultDiv.style.borderLeft = '4px solid var(--vysus-stockholm-neon)';
                    resultDiv.innerHTML = '<span style="color: var(--vysus-malmo-green); font-weight: 500;">&#10003; New candidate</span> &mdash; not found in previously interviewed candidates list.';
                } else {
                    const match = matches[0];
                    const dateStr = match.last_contacted ? new Date(match.last_contacted).toLocaleDateString('en-AU', { year: 'numeric', month: 'short', day: 'numeric' }) : 'Unknown date';
                    resultDiv.style.display = 'block';
                    resultDiv.style.background = 'rgba(249, 45, 99, 0.08)';
                    resultDiv.style.borderLeft = '4px solid #F92D63';
                    let html = '<span style="color: #F92D63; font-weight: 500;">&#10007; Previously interviewed</span>';
                    html += ` &mdash; <strong>${match.name}</strong> was last contacted <strong>${dateStr}</strong>`;
                    if (match.status) html += ` (Status: ${match.status})`;
                    if (match.level) html += ` | Level: ${match.level}`;
                    if (match.location) html += ` | Location: ${match.location}`;
                    html += '<br><span style="color: #F92D63; font-style: italic; font-size: 12px;">Check with Vysus before proceeding.</span>';
                    if (matches.length > 1) {
                        html += `<br><span style="font-size: 12px; color: var(--vysus-scandinavia-rock);">${matches.length - 1} additional match(es) found.</span>`;
                    }
                    resultDiv.innerHTML = html;
                }
            } catch (err) {
                console.log('Interview check failed:', err);
            }
        }
    </script>
</body>
</html>
